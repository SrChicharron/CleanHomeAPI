DROP DATABASE CLEANHOME;
CREATE DATABASE CLEANHOME;
USE CLEANHOME;
CREATE TABLE USER(
    USERNAME VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(50) NOT NULL,
    ENABLED BIT(1),
    PASSWORD VARCHAR(255) NOT NULL,
    PRIMARY KEY (USERNAME)
);

CREATE TABLE ROL(
    ID INT NOT NULL AUTO_INCREMENT,
    AUTHORITY VARCHAR(50) NOT NULL,
    USERNAME VARCHAR(50) NOT NULL,
    INDEX USERNM (USERNAME),
        FOREIGN KEY (USERNAME)
            REFERENCES USER(USERNAME)
            ON DELETE CASCADE,
        PRIMARY KEY (ID)
);

CREATE TABLE USUARIO(
    ID INT NOT NULL AUTO_INCREMENT,
    NAME VARCHAR(30) NOT NULL,
    LASTNAME VARCHAR(30) NOT NULL,
    CELLPHONE VARCHAR(10) NOT NULL,
    BIRTHDAY TIMESTAMP NOT NULL,
    USERNAME VARCHAR(50) NOT NULL,
    DESCRIPCION VARCHAR(255),
    FOTO VARCHAR(255) DEFAULT('sampleu.jpeg'),
    COMPROBANTE VARCHAR(255) DEFAULT('sampleu.jpeg'),
    INDEX USERNM (USERNAME),
        FOREIGN KEY (USERNAME)
            REFERENCES USER(USERNAME)
            ON DELETE CASCADE,
        PRIMARY KEY (ID)
);

CREATE TABLE SERVICIO(
    ID INT NOT NULL AUTO_INCREMENT,
    NOMBRE VARCHAR(50) NOT NULL,
    DESCRIPCION VARCHAR(150) NOT NULL,
    PRIMARY KEY (ID)
);

CREATE TABLE TIPO_PROPIEDAD(
    ID INT NOT NULL AUTO_INCREMENT,
    TIPO VARCHAR(50) NOT NULL,
    PRIMARY KEY (ID)
);

CREATE TABLE ESTADO(
    ID INT NOT NULL AUTO_INCREMENT,
    ESTADO VARCHAR(50) NOT NULL,
    PRIMARY KEY (ID)
);

CREATE TABLE PROPIEDAD(
    ID INT NOT NULL AUTO_INCREMENT,
    TITULO VARCHAR(50) NOT NULL,
    CALLE VARCHAR(50) NOT NULL,
    NUMERO_EXTERIOR VARCHAR(10) NOT NULL,
    CODIGO_POSTAL VARCHAR(10) NOT NULL,
    COLONIA VARCHAR(30) NOT NULL,
    REFERENCIAS VARCHAR(100) NOT NULL,
    ESTATUS VARCHAR(30) NOT NULL,
    ID_ESTADO INT NOT NULL,
    ID_TIPO_PROPIEDAD INT NOT NULL,
    ID_USUARIO INT NOT NULL,
    INDEX IDEST (ID_ESTADO),
    INDEX IDUSR (ID_USUARIO),
    INDEX IDTPR (ID_TIPO_PROPIEDAD),
        FOREIGN KEY (ID_ESTADO)
            REFERENCES ESTADO(ID)
            ON DELETE CASCADE,
        FOREIGN KEY (ID_USUARIO)
            REFERENCES USUARIO(ID)
            ON DELETE CASCADE,
        FOREIGN KEY (ID_TIPO_PROPIEDAD)
            REFERENCES TIPO_PROPIEDAD(ID)
            ON DELETE CASCADE,
        PRIMARY KEY (ID)
);

CREATE TABLE PUBLICACION(
    ID INT NOT NULL AUTO_INCREMENT,
    DESCRIPCION VARCHAR(100) NOT NULL,
    PAGO_OFRECIDO FLOAT(7,2) NOT NULL,
    ESTATUS VARCHAR(30) NOT NULL,
    FECHA TIMESTAMP NOT NULL,
    ID_SERVICIO INT NOT NULL,
    ID_USUARIO INT NOT NULL,
    ID_PROPIEDAD INT NOT NULL,
    INDEX IDUSR (ID_USUARIO),
    INDEX IDSRV (ID_SERVICIO),
    INDEX IDPRP (ID_PROPIEDAD),
        FOREIGN KEY (ID_USUARIO)
            REFERENCES USUARIO(ID)
            ON DELETE CASCADE,
        FOREIGN KEY (ID_SERVICIO)
            REFERENCES SERVICIO(ID)
            ON DELETE CASCADE,
        FOREIGN KEY (ID_PROPIEDAD)
            REFERENCES PROPIEDAD(ID)
            ON DELETE CASCADE,
        PRIMARY KEY (ID));

CREATE TABLE FOTO_PROPIEDAD(
    ID INT NOT NULL AUTO_INCREMENT,
    FOTO VARCHAR(100) NOT NULL,
    ID_PROPIEDAD INT NOT NULL,
    INDEX IDPRP (ID_PROPIEDAD),
        FOREIGN KEY (ID_PROPIEDAD)
            REFERENCES PROPIEDAD(ID)
            ON DELETE CASCADE,
    PRIMARY KEY (ID)
);

CREATE TABLE COMPROBANTE_PROPIEDAD(
    ID INT NOT NULL AUTO_INCREMENT,
    COMPROBANTE VARCHAR(100) NOT NULL,
    ID_PROPIEDAD INT NOT NULL,
    INDEX IDPRP (ID_PROPIEDAD),
        FOREIGN KEY (ID_PROPIEDAD)
            REFERENCES PROPIEDAD(ID)
            ON DELETE CASCADE,
    PRIMARY KEY (ID)
);

CREATE TABLE RESENA(
    ID INT NOT NULL AUTO_INCREMENT,
    ID_PUBLICACION INT NOT NULL,
    ID_EVALUADOR INT NOT NULL,
    ID_EVALUADO INT NOT NULL,
    CALIFICACION INT NOT NULL,
    COMENTARIOS VARCHAR(255),
    INDEX IDPBL (ID_PUBLICACION),
    INDEX IDEVDR (ID_EVALUADOR),
    INDEX IDEVDO (ID_EVALUADO),
    FOREIGN KEY (ID_PUBLICACION)
        REFERENCES PUBLICACION(ID)
        ON DELETE CASCADE,
    FOREIGN KEY (ID_EVALUADOR)
        REFERENCES USUARIO(ID)
        ON DELETE CASCADE,
    FOREIGN KEY (ID_EVALUADO)
        REFERENCES USUARIO(ID)
        ON DELETE CASCADE,
    PRIMARY KEY (ID)
);

CREATE TABLE POSTULACION(
    ID INT NOT NULL AUTO_INCREMENT,
    ID_PUBLICACION INT NOT NULL,
    ID_CLIENTE INT NOT NULL,
    ID_EMPLEADO INT NOT NULL,
    ESTATUS INT NOT NULL,
    INDEX IDPBC (ID_PUBLICACION),
    INDEX IDCTE (ID_CLIENTE),
    INDEX IDEMP (ID_EMPLEADO),
    FOREIGN KEY (ID_PUBLICACION)
        REFERENCES PUBLICACION(ID)
        ON DELETE CASCADE,
    FOREIGN KEY (ID_CLIENTE)
        REFERENCES USUARIO(ID)
        ON DELETE CASCADE,
    FOREIGN KEY (ID_EMPLEADO)
        REFERENCES USUARIO(ID)
        ON DELETE CASCADE,
    PRIMARY KEY (ID)
);

INSERT INTO ESTADO(ESTADO) VALUES ('Aguascalientes');
INSERT INTO ESTADO(ESTADO) VALUES ('Baja California');
INSERT INTO ESTADO(ESTADO) VALUES ('Baja California Sur');
INSERT INTO ESTADO(ESTADO) VALUES ('Campeche');
INSERT INTO ESTADO(ESTADO) VALUES ('CDMX');
INSERT INTO ESTADO(ESTADO) VALUES ('Chiapas');
INSERT INTO ESTADO(ESTADO) VALUES ('Chihuahua');
INSERT INTO ESTADO(ESTADO) VALUES ('Coahuila');
INSERT INTO ESTADO(ESTADO) VALUES ('Colima');
INSERT INTO ESTADO(ESTADO) VALUES ('Durango');
INSERT INTO ESTADO(ESTADO) VALUES ('Guanajuato');
INSERT INTO ESTADO(ESTADO) VALUES ('Guerrero');
INSERT INTO ESTADO(ESTADO) VALUES ('Hidalgo');
INSERT INTO ESTADO(ESTADO) VALUES ('Jalisco');
INSERT INTO ESTADO(ESTADO) VALUES ('Estado de México');
INSERT INTO ESTADO(ESTADO) VALUES ('Michoacán');
INSERT INTO ESTADO(ESTADO) VALUES ('Morelos');
INSERT INTO ESTADO(ESTADO) VALUES ('Nayarit');
INSERT INTO ESTADO(ESTADO) VALUES ('Nuevo León');
INSERT INTO ESTADO(ESTADO) VALUES ('Oaxaca');
INSERT INTO ESTADO(ESTADO) VALUES ('Puebla');
INSERT INTO ESTADO(ESTADO) VALUES ('Querétaro');
INSERT INTO ESTADO(ESTADO) VALUES ('Quintana Roo');
INSERT INTO ESTADO(ESTADO) VALUES ('San Luis Potosí');
INSERT INTO ESTADO(ESTADO) VALUES ('Sinaloa');
INSERT INTO ESTADO(ESTADO) VALUES ('Sonora');
INSERT INTO ESTADO(ESTADO) VALUES ('Tabasco');
INSERT INTO ESTADO(ESTADO) VALUES ('Tamaulipas');
INSERT INTO ESTADO(ESTADO) VALUES ('Tlaxcala');
INSERT INTO ESTADO(ESTADO) VALUES ('Veracruz');
INSERT INTO ESTADO(ESTADO) VALUES ('Yucatán');
INSERT INTO ESTADO(ESTADO) VALUES ('Zacatecas');

INSERT INTO TIPO_PROPIEDAD(TIPO) VALUES('Casa');
INSERT INTO TIPO_PROPIEDAD(TIPO) VALUES('Departamento');
INSERT INTO TIPO_PROPIEDAD(TIPO) VALUES('Local');

INSERT INTO SERVICIO(NOMBRE, DESCRIPCION) VALUES('Limpieza Basica','Barrer y trapear');
INSERT INTO SERVICIO(NOMBRE, DESCRIPCION) VALUES('Limpieza Basica','Desempolvar muebles, barrer, trapear');


